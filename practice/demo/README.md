# Демонстрационные сценарии

Эта папка содержит задания и решения, разбираемые на воркшопе, плюс одно дополнительное задание со звёздочкой. В файле `tasks.md` описаны все задания, а папка `solutions` содержит в себе объяснения решений и файлы `.rego`, которые можно запустить для проверки решений.

## Список заданий

### 1. Разноцветная рыба должна жить только в аквариуме Coral Haven
Рыба с цветом `Multicolor` может жить только в аквариуме `Coral Haven`. Написать политику, которая проверяет, что она не находится в другом аквариуме. Если она находится в другом аквариуме, вывести предупреждение, что рыба определённого вида с определённым именем находится не в нужном аквариуме.

### 2. Совпадает ли тип воды в аквариуме с тем, который нужен рыбе
Написать политику, которая проверяет, что требуемый тип воды для рыбы совпадает с тем, который находится в аквариуме. В аквариуме с водой `Mixed` может жить любая рыба. Если тип воды не совпадает, вывести предупреждение, что рыба определённого вида с определённым именем находится не в нужной воде.

### 3. Не превышает ли количество рыб в аквариуме допустимое значение
Написать политику, которая проверяет, что количество рыб в аквариуме не превышает его максимальную вместимость. Если рыб в аквариуме больше допустимого, вывести предупреждение, что в определённом аквариуме находится `N` рыб, а его максимальная вместимость - `M`.

### 4. Количество рыб каждого вида во всех аквариумах
Написать политику, которая выводит количество рыб каждого вида во всех аквариумах. Каждый вид в выводе должен встречаться только 1 раз.

## Способы решения
Решать задания и приверять их можно тремя способами...

### Способ 1 - плагин VS Code (Open Policy Agent)
Для решения задач этим способом необходимо создать в этой директории (`practice/demo`) файл в формате `.rego`. В этом файле будет происходить написание политик, а входные данные будут браться из файла `input.json`. Для запуска решений в папке `solutions` необходимо переместить файл `input.json` в эту папку, после чего открыть файл в VS Code и выполнить желаемую политику.

### Способ 2 - [conftest](https://www.conftest.dev/)
При условии, что [conftest](https://www.conftest.dev/) уже установлен на ПК, для удобства необходимо создать папку `policy` и писать политики в файлах `.rego` внутри этой папки. После чего запускать conftest и смотреть на результаты. Поскольку входящий файл всегда один и тот же, команда для всех политик (при условии, что они находятся в папке `policy`) будет одинаковой.

```sh
mkdir policy
# ... написание политики ... переходить в консоли в папку policy не надо!
conftest test --parser json input.json --all-namespaces
```

Для запуска всех предоставленных решений необходимо выполнить команду:
```sh
conftest test -p solutions --parser json input.json --all-namespaces
```

### Способ 3 - [Rego Playground](https://play.openpolicyagent.org/)
Необходимо скопировать содержимое файла `input.json` и вставить в окно `INPUT`, а в основном окне писать политику. Для запуска предоставленных решений достаточно в основное окно вставить содержимое `.rego` файлов в папке `solutions`.
